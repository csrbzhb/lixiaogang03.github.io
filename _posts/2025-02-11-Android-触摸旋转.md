---
layout:     post
title:      Android 触摸旋转
subtitle:   USB I2C
date:       2025-02-11
author:     LXG
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - markdown
---

## 触摸类型对比

| **对比项**          | **USB 触摸屏**                                   | **I2C 触摸屏**                                  |
|---------------------|--------------------------------|--------------------------------|
| **通信方式**        | USB HID 协议（标准接口）        | I2C 总线（私有协议）           |
| **数据传输方式**    | 通过 HID 事件发送触摸数据       | 通过 I2C 读取寄存器数据        |
| **驱动层**         | **标准 HID 触摸驱动（hid-multitouch.c）**，由 Android InputReader 处理 | **定制 I2C 触摸驱动**，厂商自定义协议 |
| **事件处理**        | 通过 `/dev/input/eventX` 直接传输 | 需要从 I2C 设备读取数据        |
| **旋转支持**        | **系统层面支持**（可通过 `idc` 或 `InputReader` 旋转） | **驱动层需要额外适配** |
| **旋转方式**        | 通过 `idc` 配置 `swapXY`、`invertX`、`invertY` | 需要修改驱动代码手动调整坐标 |
| **框架支持**        | **Android 自带 HID 触摸屏支持**，可以通过 `InputReader.cpp` 处理 | **不通用**，不同 I2C 触摸芯片需要不同适配 |
| **是否需要修改驱动** | ❌ **通常不需要**，可直接调整 `.idc` 文件 | ✅ **需要修改内核驱动代码** |
| **实现难度**        | ⭐（简单，修改 `.idc` 即可） | ⭐⭐⭐（复杂，需要改驱动代码） |


## 汇顶I2C触摸旋转

```c

			ctp {
				status = "okay";
				compatible = "allwinner,goodix";
				reg = <0x5d>;
				device_type = "ctp";
				ctp_name = "gt9xxnew_ts";
				ctp_twi_id = <0x1>;
				ctp_twi_addr = <0x5d>;
				ctp_screen_max_x = <1024>;
				ctp_screen_max_y = <600>;
				ctp_revert_x_flag = <1>;
				ctp_revert_y_flag = <1>;
				ctp_exchange_x_y_flag = <0>;
				ctp_int_port = <&pio PH 18 6 0xffffffff 0xffffffff 0>;
				ctp_wakeup = <&pio PH 19 1 0xffffffff 0xffffffff 1>;
				ctp-supply = <&reg_ldoio0>;
				ctp_power_ldo_vol = <3300>;
			};

```

| 旋转角度 | ctp_revert_x_flag | ctp_revert_y_flag | ctp_exchange_x_y_flag |
|----------|----------------------|----------------------|----------------------|
| **0° (默认)** | 0 | 0 | 0 |
| **90°** | 0 | 1 | 1 |
| **180°** | 1 | 1 | 0 |
| **270°** | 1 | 0 | 1 |















