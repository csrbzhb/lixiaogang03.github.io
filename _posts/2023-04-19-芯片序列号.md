---
layout:     post
title:      芯片序列号
subtitle:   Allwinner Rockchip
date:       2023-04-19
author:     LXG
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - chipid
---

## 全志

D1_Linux_SID_开发指南.pdf

对于全志的 SoC 来说，ChipID 用于该 SoC 的唯一标识。

ChipID 由 4 个 word（16 个 byte）组成，共 128bit，通常放在 Efuse（见 2.1.3 节）的起始 4 个 word。

SID 是一个比较独立的模块，在 Linux 内核中没有依赖其他子系统，存放在 drivers/soc/sunxi 目录中。SID 为其他模块提供 API 的调用方式。关系如下图：

![allwinner_sid](/images/allwinner/allwinner_sid.png)

1）Thermal、GMAC 的校准参数保存在 SID 中；
2）CE 会用到 SID 中的一些 Key；
3）Sysinfo 比较特殊，为了方便用户空间获取、调试 SID 信息，专门设计的一个字符型设备驱动

## A133 ChipID 查看

```txt

ceres-c3:/ $ cat sys/class/sunxi_info/sys_info
sunxi_platform    : sun50iw10
sunxi_secure      : normal
sunxi_chipid      : 538014008c0048140144c880407d2190
sunxi_serial      : 407d21900144c88000008c0000000000
sunxi_chiptype    : 00001400
sunxi_batchno     : 0x18550004

```

## DTS

sun50iw10p1.dtsi

```c

/ {
	model = "sun50iw10";
	compatible = "arm,sun50iw10p1";
	interrupt-parent = <&wakeupgen>;
	#address-cells = <2>;
	#size-cells = <2>;

	sid: sunxi-sid@03006000 {
		compatible = "allwinner,sunxi-sid";
		device_type = "sid";
		reg = <0x0 0x03006000 0 0x1000>;
	};

	sunxi-sid-ng@03006000 {
		compatible = "allwinner,sun50iw10p1-sid";
		reg = <0x0 0x03006000 0 0x1000>;
		#address-cells = <1>;
		#size-cells = <1>;

		speedbin_efuse: speed@00 {
			reg = <0x0 2>;
		};

		ths_calib: calib@14 {
			reg = <0x14 8>;
		};

		cpubin_efuse: calib@1c {
			reg = <0x1c 2>;
		};

		cpubin_extend: calib@28 {
			reg = <0x28 4>;
		};
	};

	chipid: sunxi-chipid@03006200 {
		compatible = "allwinner,sunxi-chipid";
		device_type = "chipid";
		reg = <0x0 0x03006200 0 0x0200>;
	};
}

```

## 驱动

longan/kernel/linux-4.9/drivers/soc/sunxi/sunxi-sid.c

```c

static unsigned int sunxi_soc_chipid[4];

/**
 * soc chipid:
 */
int sunxi_get_soc_chipid(u8 *chipid)
{
	sid_chipid_init();

        // 53801400-8c004814-0144c880-407d2190                       // 10 进制 -------16进制
	SID_ERR("sunxi_soc_chipid[0] = %u\n", sunxi_soc_chipid[0]);  // 1400902656-----53801400
	SID_ERR("sunxi_soc_chipid[1] = %u\n", sunxi_soc_chipid[1]);  // 2348828692-----8c004814
	SID_ERR("sunxi_soc_chipid[2] = %u\n", sunxi_soc_chipid[2]);  // 21284992-------0144c880
	SID_ERR("sunxi_soc_chipid[3] = %u\n", sunxi_soc_chipid[3]);  // 1081942416-----407d2190
	memcpy(chipid, sunxi_soc_chipid, 16);

	return 0;
}
EXPORT_SYMBOL(sunxi_get_soc_chipid);

```

drivers/char/sunxi-sysinfo/sunxi-sysinfo.c

```c

static ssize_t sys_info_show(struct class *class,
			     struct class_attribute *attr, char *buf)
{
	int i;
	int databuf[4] = {0};
	char tmpbuf[129] = {0};
	size_t size = 0;

        // ------------------------------------------------------------
	/* chipid */
	sunxi_get_soc_chipid((u8 *)databuf);

	for (i = 0; i < 4; i++)
		sprintf(tmpbuf + i*8, "%08x", databuf[i]);
	tmpbuf[128] = 0;
	size += sprintf(buf + size, "sunxi_chipid      : %s\n", tmpbuf);

        //--------------------------------------------------------------

	return size;
}

```











