---
layout:     post
title:      T113 Buildroot 裁剪
subtitle:   Flash Memory
date:       2023-12-07
author:     LXG
header-img: img/post-bg-keybord.jpg
catalog: true
tags:
    - t113
---

## Memory

**查看进程列表**

```txt

sh-4.4# ps
PID   USER     COMMAND
    1 root     init
    2 root     [kthreadd]
    3 root     [rcu_gp]
    4 root     [rcu_par_gp]
    5 root     [kworker/0:0-eve]
    6 root     [kworker/0:0H-kb]
    7 root     [kworker/u4:0-ev]
    8 root     [mm_percpu_wq]
    9 root     [ksoftirqd/0]
   10 root     [rcu_preempt]
   11 root     [migration/0]
   12 root     [cpuhp/0]
   13 root     [cpuhp/1]
   14 root     [migration/1]
   15 root     [ksoftirqd/1]
   16 root     [kworker/1:0-mm_]
   17 root     [kworker/1:0H-kb]
   18 root     [kdevtmpfs]
   19 root     [kworker/u4:1-ev]
   21 root     [rcu_tasks_kthre]
   32 root     [kworker/0:1-eve]
   33 root     [kworker/1:1-mm_]
   39 root     [kworker/u4:2-ev]
  416 root     [oom_reaper]
  417 root     [writeback]
  453 root     [kblockd]
  593 root     [ion_system_heap]
  615 root     [watchdogd]
  710 root     [cfg80211]
  719 root     [kswapd0]
  730 root     [vsync proc 0]
  731 root     [vsync proc 1]
  733 root     [kworker/1:2-pm]
  820 root     [uas]
  892 root     [irq/41-mmc2]
  905 root     [kworker/0:2-rcu]
  914 root     [gpio_wq]
  929 root     [mmc_complete]
  939 root     [kworker/0:1H-ev]
  954 root     [ipv6_addrconf]
  961 root     [krfcommd]
  968 root     [tve detect]
  977 root     [kworker/1:3]
  985 root     [irq/67-gt9xx]
 1013 root     [kworker/1:1H-kb]
 1014 root     [kworker/1:2H-ev]
 1015 root     [jbd2/mmcblk0p6-]
 1016 root     [ext4-rsv-conver]
 1032 root     /sbin/syslogd -n
 1036 root     /sbin/klogd -n
 1039 root     [ext4-rsv-conver]
 1043 root     /sbin/udevd -d
 1102 root     [kworker/0:2H-mm]
 1103 root     [btfwwork]
 1104 root     [bttimerwork]
 1105 root     [kworker/u5:0-hc]
 1106 root     [kworker/u5:1-hc]
 1111 root     [kworker/u5:2]
 1123 root     dbus-daemon --system
 1144 root     /sbin/dhcpcd -f /etc/dhcpcd.conf
 1146 root     bluetoothd
 1147 root     bluealsa -p a2dp-sink
 1155 root     [kworker/0:3-rcu]
 1156 root     [RTW_CMD_THREAD]
 1174 root     /usr/sbin/dropbear -R
 1181 root     /usr/sbin/telnetd -F
 1183 root     4G-demon
 1197 root     /usr/bin/monitor_usb
 1209 root     {rcS} /bin/sh /etc/init.d/rcS
 1210 root     -/bin/sh
 1251 root     DeviceTest
 1256 root     adbd
 1268 root     {adb_conf.sh} /bin/sh /etc/adb_conf.sh start
 1365 root     /bin/sh -
 1542 root     /sbin/udevd -d
 1543 root     /sbin/udevd -d
 1565 root     pppd /dev/ttyUSB2 115200 user user password passwd connect ''cha
 1570 root     sleep 1
 1571 root     ps
 
```

**查看各个进程内存情况**

```txt

Mem: 83976K used, 26108K free, 424K shrd, 2244K buff, 36096K cached
CPU:  48% usr  43% sys   0% nic   7% idle   0% io   0% irq   0% sirq
Load average: 1.78 1.15 0.60 2/80 6466
  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND
 1251  1209 root     S    79456  72%  41% DeviceTest
 1256     1 root     S    55452  50%   0% adbd
 1147     1 root     S    34532  31%   0% bluealsa -p a2dp-sink
 1183     1 root     S     9684   9%   0% 4G-demon
 1146     1 root     S     5672   5%   0% bluetoothd
 6386     1 root     S     4584   4%   0% pppd /dev/ttyUSB2 115200 user user pas
 1365  1256 root     S     2940   3%   0% /bin/sh -
 1210     1 root     S     2940   3%   0% -/bin/sh
 1209     1 root     S     2692   2%   0% {rcS} /bin/sh /etc/init.d/rcS
 1268     1 root     S     2688   2%   0% {adb_conf.sh} /bin/sh /etc/adb_conf.sh
 1043     1 root     S     2472   2%   0% /sbin/udevd -d
 1123     1 root     S     2392   2%   0% dbus-daemon --system
 6357  1365 root     R     2272   2%   0% top
 1144     1 root     S     2156   2%   0% /sbin/dhcpcd -f /etc/dhcpcd.conf
    1     0 root     S     2152   2%   0% init
 1032     1 root     S     2152   2%   0% /sbin/syslogd -n
 1036     1 root     S     2152   2%   0% /sbin/klogd -n
 1181     1 root     S     2152   2%   0% /usr/sbin/telnetd -F
 6466  1268 root     S     2020   2%   0% sleep 1
 1174     1 root     S     1868   2%   0% /usr/sbin/dropbear -R

```

**watch命令监控系统可用内存**

watch -n 1 "grep MemAvailable /proc/meminfo | awk '{print $2}'"


## flash

**buildroot子目录大小**

```txt

t113_linux/out/t113/evb1_auto/longan/buildroot/target$ du -sh *
1.4M	bin
12K	dev
6.7M	etc
0	init
16M	lib
0	lib32
0	linuxrc
4.0K	media
4.0K	mnt
4.0K	opt
4.0K	proc
4.0K	root
50M	rp_test
8.0K	run
3.6M	sbin
4.0K	sys
4.0K	THIS_IS_NOT_YOUR_ROOT_FILESYSTEM
8.0K	tmp
257M	usr
1.6M	var

-------------------------------------------------------------------------------

t113_linux/out/t113/evb1_auto/longan/buildroot/target/rp_test$ du -sh *
8.0K	comtest
6.2M	input
4.0K	test_4G.sh
4.0K	test_audio.sh
4.0K	test_bt.sh
4.0K	test_can.sh
4.0K	test_ethernet.sh
4.0K	test_uart.sh
4.0K	test_watchdog.sh
44M	test.wav
4.0K	test_wifi_ap.sh
4.0K	test_wifi.sh
4.0K	watchdogd.cpp
4.0K	watchdogd.out

-------------------------------------------------------------------------------

t113_linux/out/t113/evb1_auto/longan/buildroot/target/usr$ du -sh *
30M	bin
104M	lib
0	lib32
1.5M	libexec
91M	local
7.0M	sbin
26M	share

------------------------------------------------------------------------------

t113_linux/out/t113/evb1_auto/longan/buildroot/target/usr/lib$ du -sh * | sort -rh
14M	python3.7
11M	libavcodec.so.57.107.100
11M	gstreamer-1.0
2.4M	postgresql
2.3M	libcrypto.so.1.1
2.1M	libpython3.7m.so.1.0
2.1M	libcdx_parser.so
1.9M	libx265.so.160
1.9M	libavformat.so.57.83.100
1.7M	libavfilter.so.6.107.100
1.5M	libsamplerate.so.0.1.8
1.5M	libgnutls.so.30.23.1
1.3M	xtables
1.3M	libvpx.so.5.0.0
1.3M	libgio-2.0.so.0.5600.3
1.1M	libxml2.so.2.9.9
1.1M	libx264.so.157
1.1M	libsdk_camera.so
1.1M	liblive555.so
1.1M	libgstreamer-1.0.so.0.1404.0

-----------------------------------------------------------------------------------

t113_linux/out/t113/evb1_auto/longan/buildroot/target/usr/local/Qt_5.12.5$ du -sh * 
21M	fonts
47M	lib
12M	plugins
13M	qml


------------------------------------------------------------------------------------

lxg@lxg:~/code/t113_linux/out/t113/evb1_auto/longan/buildroot/target/usr/bin$ du -sh * | sort -rh
5.4M	postgres
3.4M	gdb
1.7M	vim
1.1M	bluetoothd
988K	MediaUI
824K	ecpg
500K	DeviceTest
440K	psql
428K	btmon
304K	pg_dump
292K	my_print_defaults
284K	mysql_client_test
280K	resolve_stack_dump
280K	perror
276K	resolveip
276K	replace
260K	v4l2-ctl
244K	v4l2-compliance
232K	gdbserver
232K	ffmpeg
228K	udevadm

```

**buildroot子目录文件树**

```txt

lxg@lxg:~/code/t113_linux/out/t113/evb1_auto/longan/buildroot/target$ tree -L 2
.
├── bin
│   ├── arch -> busybox
│   ├── ash -> busybox
│   ├── base64 -> busybox
│   ├── bash
│   ├── busybox
│   ├── cat -> busybox
│   ├── chattr
│   ├── chgrp -> busybox
│   ├── chmod -> busybox
│   ├── chown -> busybox
│   ├── clockdiff
│   ├── compile_et
│   ├── cp -> busybox
│   ├── cpio -> busybox
│   ├── date -> busybox
│   ├── dd -> busybox
│   ├── df -> busybox
│   ├── dmesg -> busybox
│   ├── dnsdomainname -> busybox
│   ├── dumpkmap -> busybox
│   ├── echo -> busybox
│   ├── egrep -> busybox
│   ├── false -> busybox
│   ├── fdflush -> busybox
│   ├── fgrep -> busybox
│   ├── getopt -> busybox
│   ├── grep -> busybox
│   ├── gunzip -> busybox
│   ├── gzip -> busybox
│   ├── hostname -> busybox
│   ├── kill -> busybox
│   ├── link -> busybox
│   ├── linux32 -> busybox
│   ├── linux64 -> busybox
│   ├── ln -> busybox
│   ├── login -> busybox
│   ├── ls -> busybox
│   ├── lsattr
│   ├── mk_cmds
│   ├── mkdir -> busybox
│   ├── mknod -> busybox
│   ├── mktemp -> busybox
│   ├── more -> busybox
│   ├── mount -> busybox
│   ├── mountpoint -> busybox
│   ├── mt -> busybox
│   ├── mv -> busybox
│   ├── netstat -> busybox
│   ├── nice -> busybox
│   ├── nuke -> busybox
│   ├── pidof -> busybox
│   ├── ping
│   ├── pipe_progress -> busybox
│   ├── printenv -> busybox
│   ├── ps -> busybox
│   ├── pwd -> busybox
│   ├── resume -> busybox
│   ├── rm -> busybox
│   ├── rmdir -> busybox
│   ├── run-parts -> busybox
│   ├── sed -> busybox
│   ├── setarch -> busybox
│   ├── setpriv -> busybox
│   ├── setserial -> busybox
│   ├── sh -> bash
│   ├── sleep -> busybox
│   ├── stty -> busybox
│   ├── su -> busybox
│   ├── sync -> busybox
│   ├── tar -> busybox
│   ├── touch -> busybox
│   ├── tracepath
│   ├── traceroute6
│   ├── true -> busybox
│   ├── umount -> busybox
│   ├── uname -> busybox
│   ├── usleep -> busybox
│   ├── vi -> ../usr/bin/vim
│   ├── watch -> busybox
│   └── zcat -> busybox
├── dev
│   ├── fd -> ../proc/self/fd
│   ├── log -> ../tmp/log
│   ├── pts
│   ├── shm
│   ├── stderr -> ../proc/self/fd/2
│   ├── stdin -> ../proc/self/fd/0
│   └── stdout -> ../proc/self/fd/1
├── etc
│   ├── adb_conf.sh
│   ├── asound.conf
│   ├── bt_init.sh
│   ├── bt_play.sh
│   ├── cedarc.conf
│   ├── cedarx.conf
│   ├── config.ini
│   ├── dbus-1
│   ├── deviceTest.ini
│   ├── dhcp
│   ├── dhcpcd.conf
│   ├── dropbear -> /var/run/dropbear
│   ├── dvrconfig.ini
│   ├── ethertypes
│   ├── fonts
│   ├── freerdp
│   ├── fstab
│   ├── fw_env.config
│   ├── group
│   ├── hostapd.conf
│   ├── hostname
│   ├── hosts
│   ├── init.d
│   ├── inittab
│   ├── inputrc
│   ├── iproute2
│   ├── issue
│   ├── libnl
│   ├── localtime -> ../usr/share/zoneinfo/Etc/UTC
│   ├── longan.conf
│   ├── mdev
│   ├── mdev.conf
│   ├── mke2fs.conf
│   ├── mount-sd.sh
│   ├── mtab -> ../proc/self/mounts
│   ├── network
│   ├── nsswitch.conf
│   ├── os-release -> ../usr/lib/os-release
│   ├── passwd
│   ├── ppp
│   ├── profile
│   ├── profile.d
│   ├── protocols
│   ├── qtenv.sh
│   ├── rc_keymaps
│   ├── rc_maps.cfg
│   ├── resolv.conf -> ../tmp/resolv.conf
│   ├── services
│   ├── shadow
│   ├── shells
│   ├── ssl
│   ├── swupdate_cmd.sh
│   ├── timezone
│   ├── ts.conf
│   ├── udev
│   ├── udhcpd.conf
│   ├── wifi
│   ├── wlan-connect.sh
│   ├── wlan-softap.sh
│   ├── wpa_supplicant.conf
│   └── xdg
├── init -> bin/busybox
├── lib
│   ├── bash
│   ├── debug
│   ├── dhcpcd
│   ├── firmware
│   ├── ld-2.25.so
│   ├── ld-linux.so.3 -> ld-2.25.so
│   ├── libanl-2.25.so
│   ├── libanl.so.1 -> libanl-2.25.so
│   ├── libatomic.so.1 -> libatomic.so.1.2.0
│   ├── libatomic.so.1.2.0
│   ├── libblkid.so.1 -> libblkid.so.1.1.0
│   ├── libblkid.so.1.1.0
│   ├── libc-2.25.so
│   ├── libcrypt-2.25.so
│   ├── libcrypt.so.1 -> libcrypt-2.25.so
│   ├── libc.so.6 -> libc-2.25.so
│   ├── libdl-2.25.so
│   ├── libdl.so.2 -> libdl-2.25.so
│   ├── libgcc_s.so.1
│   ├── libgfortran.so.4 -> libgfortran.so.4.0.0
│   ├── libgfortran.so.4.0.0
│   ├── libm-2.25.so
│   ├── libmount.so.1 -> libmount.so.1.1.0
│   ├── libmount.so.1.1.0
│   ├── libm.so.6 -> libm-2.25.so
│   ├── libnsl-2.25.so
│   ├── libnsl.so.1 -> libnsl-2.25.so
│   ├── libnss_dns-2.25.so
│   ├── libnss_dns.so.2 -> libnss_dns-2.25.so
│   ├── libnss_files-2.25.so
│   ├── libnss_files.so.2 -> libnss_files-2.25.so
│   ├── libpthread-2.25.so
│   ├── libpthread.so.0 -> libpthread-2.25.so
│   ├── libresolv-2.25.so
│   ├── libresolv.so.2 -> libresolv-2.25.so
│   ├── librt-2.25.so
│   ├── librt.so.1 -> librt-2.25.so
│   ├── libstdc++.so.6 -> libstdc++.so.6.0.24
│   ├── libstdc++.so.6.0.24
│   ├── libstdc++.so.6.0.24-gdb.py
│   ├── libthread_db-1.0.so
│   ├── libthread_db.so.1 -> libthread_db-1.0.so
│   ├── libudev.so.1 -> libudev.so.1.6.3
│   ├── libudev.so.1.6.3
│   ├── libutil-2.25.so
│   ├── libutil.so.1 -> libutil-2.25.so
│   ├── libuuid.so.1 -> libuuid.so.1.3.0
│   ├── libuuid.so.1.3.0
│   ├── modules
│   ├── pkgconfig
│   └── udev
├── lib32 -> lib
├── linuxrc -> bin/busybox
├── media
├── mnt
├── opt
├── proc
├── root
├── rp_test
│   ├── comtest
│   ├── input
│   ├── test_4G.sh
│   ├── test_audio.sh
│   ├── test_bt.sh
│   ├── test_can.sh
│   ├── test_ethernet.sh
│   ├── test_uart.sh
│   ├── test_watchdog.sh
│   ├── test.wav
│   ├── test_wifi_ap.sh
│   ├── test_wifi.sh
│   ├── watchdogd.cpp
│   └── watchdogd.out
├── run
│   └── dbus
├── sbin
│   ├── arp -> ../bin/busybox
│   ├── arping
│   ├── badblocks
│   ├── blkid -> ../bin/busybox
│   ├── bridge
│   ├── ctstat -> lnstat
│   ├── devlink
│   ├── devmem -> ../bin/busybox
│   ├── dhclient
│   ├── dhclient-script
│   ├── dhcpcd
│   ├── dumpe2fs
│   ├── e2freefrag
│   ├── e2fsck
│   ├── e2label -> tune2fs
│   ├── e2mmpstatus -> dumpe2fs
│   ├── e2undo
│   ├── e4crypt
│   ├── fdisk -> ../bin/busybox
│   ├── filefrag
│   ├── freeramdisk -> ../bin/busybox
│   ├── fsck
│   ├── fsck.ext2 -> e2fsck
│   ├── fsck.ext3 -> e2fsck
│   ├── fsck.ext4 -> e2fsck
│   ├── fstrim -> ../bin/busybox
│   ├── genl
│   ├── getty -> ../bin/busybox
│   ├── halt -> ../bin/busybox
│   ├── hdparm -> ../bin/busybox
│   ├── hwclock -> ../bin/busybox
│   ├── ifcfg
│   ├── ifconfig -> ../bin/busybox
│   ├── ifdown -> ../bin/busybox
│   ├── ifstat
│   ├── ifup -> ../bin/busybox
│   ├── init -> ../bin/busybox
│   ├── insmod -> ../bin/busybox
│   ├── ip
│   ├── ipaddr -> ../bin/busybox
│   ├── iplink -> ../bin/busybox
│   ├── ipneigh -> ../bin/busybox
│   ├── iproute -> ../bin/busybox
│   ├── iprule -> ../bin/busybox
│   ├── iptunnel -> ../bin/busybox
│   ├── iwconfig
│   ├── iwgetid -> iwconfig
│   ├── iwlist -> iwconfig
│   ├── iwpriv -> iwconfig
│   ├── iwspy -> iwconfig
│   ├── klogd -> ../bin/busybox
│   ├── lnstat
│   ├── loadkmap -> ../bin/busybox
│   ├── logsave
│   ├── losetup -> ../bin/busybox
│   ├── lsmod -> ../bin/busybox
│   ├── makedevs -> ../bin/busybox
│   ├── mdev -> ../bin/busybox
│   ├── mkdosfs -> mkfs.fat
│   ├── mke2fs
│   ├── mkfs.ext2 -> mke2fs
│   ├── mkfs.ext3 -> mke2fs
│   ├── mkfs.ext4 -> mke2fs
│   ├── mkfs.fat
│   ├── mkfs.msdos -> mkfs.fat
│   ├── mkfs.ntfs -> /usr/sbin/mkntfs
│   ├── mkfs.vfat -> mkfs.fat
│   ├── mklost+found
│   ├── mkswap -> ../bin/busybox
│   ├── modprobe -> ../bin/busybox
│   ├── mount.lowntfs-3g -> /usr/bin/lowntfs-3g
│   ├── mount.ntfs-3g -> /usr/bin/ntfs-3g
│   ├── nameif -> ../bin/busybox
│   ├── nstat
│   ├── pivot_root -> ../bin/busybox
│   ├── poweroff -> ../bin/busybox
│   ├── rarpd
│   ├── rdisc
│   ├── rdma
│   ├── reboot -> ../bin/busybox
│   ├── resize2fs
│   ├── rmmod -> ../bin/busybox
│   ├── route -> ../bin/busybox
│   ├── routef
│   ├── routel
│   ├── rtacct
│   ├── rtmon
│   ├── rtpr
│   ├── rtstat -> lnstat
│   ├── run-init -> ../bin/busybox
│   ├── runlevel -> ../bin/busybox
│   ├── setconsole -> ../bin/busybox
│   ├── ss
│   ├── start-stop-daemon -> ../bin/busybox
│   ├── sulogin -> ../bin/busybox
│   ├── swapoff -> ../bin/busybox
│   ├── swapon -> ../bin/busybox
│   ├── switch_root -> ../bin/busybox
│   ├── sysctl -> ../bin/busybox
│   ├── syslogd -> ../bin/busybox
│   ├── tc
│   ├── tipc
│   ├── tune2fs
│   ├── udevadm -> /usr/bin/udevadm
│   ├── udevd
│   ├── udhcpc -> ../bin/busybox
│   ├── uevent -> ../bin/busybox
│   ├── vconfig -> ../bin/busybox
│   └── watchdog -> ../bin/busybox
├── sys
├── THIS_IS_NOT_YOUR_ROOT_FILESYSTEM
├── tmp
│   └── fontconfig
├── usr
│   ├── bin
│   ├── lib
│   ├── lib32 -> lib
│   ├── libexec
│   ├── local
│   ├── sbin
│   └── share
└── var
    ├── cache -> ../tmp
    ├── db
    ├── lib
    ├── lock -> ../tmp
    ├── log -> ../tmp
    ├── run -> ../run
    ├── spool -> ../tmp
    ├── tmp -> ../tmp
    └── www

61 directories, 299 files

```
