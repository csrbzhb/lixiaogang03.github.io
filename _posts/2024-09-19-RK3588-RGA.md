---
layout:     post
title:      RK3588 RGA
subtitle:   Raster Graphic Acceleration Unit
date:       2024-09-19
author:     LXG
header-img: img/post-bg-xiaomi.jpg
catalog: true
tags:
    - RK3588
---

[librga-github](https://github.com/airockchip/librga)

[Rockchip_Developer_Guide_RGA_CN-github](https://github.com/airockchip/librga/blob/main/docs/Rockchip_Developer_Guide_RGA_CN.md)

[Rockchip_FAQ_RGA_CN-github](https://github.com/airockchip/librga/blob/main/docs/Rockchip_FAQ_RGA_CN.md)

## 概念

RGA (Raster Graphic Acceleration Unit)是一个独立的2D硬件加速器，可用于加速点/线绘制，执行图像缩放、旋转、bitBlt、alpha混合等常见的2D图形操作。

## 版本

![rk3588_rga_1](/images/rockchip/rk3588_rga_1.png)
![rk3588_rga_2](/images/rockchip/rk3588_rga_2.png)
![rk3588_rga_3](/images/rockchip/rk3588_rga_3.png)

## 支持库librga.so

**查看支持库的版本**

```txt

$ adb shell strings vendor/lib64/librga.so | grep rga_api
rga_api version 1.10.1_[0]

```

**源码**

```txt

hardware/rockchip/librga$ tree -L 1
├── Android.bp
├── Android.go
├── Android.mk
├── buildroot.cmake
├── CHANGELOG.md
├── cmake-android.sh
├── cmake-linux.sh
├── CMakeLists.txt
├── COPYING
├── core
├── cross
├── debian
├── docs
├── im2d_api
├── include
├── meson.build
├── meson_options.txt
├── meson.sh
├── README.md
├── samples
└── version.h.template

```

## 驱动

**源码**

```txt

kernel-5.10/drivers/video/rockchip$ tree  -L 1
├── built-in.a
├── dvbm
├── iep
├── Kconfig
├── Makefile
├── modules.order
├── mpp
├── rga
├── rga2
├── rga3
└── rve

```

**查看驱动版本**

```txt

$ adb shell cat /sys/kernel/debug/rkrga/driver_version
RGA multicore Device Driver: v1.3.3

adb shell cat /proc/rkrga/driver_version

```

## 版本对应关系

使用RGA时需要确认保证当前的运行环境是可以正常工作的，下表为常用的librga与驱动版本对应关系。

| librga版本    | 对应驱动                                                     | 硬件支持         |
| ------------- | ------------------------------------------------------------ | ---------------- |
| 无版本号      | 对应SDK内驱动                                                | RGA1、RGA2       |
| 1.0.0 ~ 1.3.2 | RGA Device Driver（kernel - 4.4及以上）<br/>RGA2 Device Driver（无版本号或v2.1.0） | RGA1、RGA2       |
| > 1.4.0       | RGA multicore Device Driver（v1.2.0及以上）                  | RGA2、RGA3       |
| > 1.9.0       | RGA Device Driver（kernel-4.4及以上）<br/>RGA2 Device Driver（无版本号和v2.1.0）<br/>RGA multicore Device Driver（v1.2.0及以上） | RGA1、RGA2、RGA3 |

## 单独升级RGA驱动后的报错日志

```txt

[    4.136864] [    T1] rga: Module initialized. v1.3.3

[ 3739.834327] [ T2050] rga_dma_buf: Fail to get dma_buf from fd[111], ret[-9]
[ 3739.834339] [ T2050] rga_mm: rga_mm_map_dma_buffer core[1] map dma buffer error!
[ 3739.834342] [ T2050] rga_mm: rga_mm_map_buffer map dma_buf error!
[ 3739.834345] [ T2050] rga: buffer[0] mm import buffer failed! memory = 0x6f, type = dma_fd(0x0)
[ 3739.856581] [ T2050] rga_dma_buf: Fail to get dma_buf from fd[111], ret[-9]
[ 3739.856595] [ T2050] rga_mm: rga_mm_map_dma_buffer core[1] map dma buffer error!
[ 3739.856598] [ T2050] rga_mm: rga_mm_map_buffer map dma_buf error!
[ 3739.856602] [ T2050] rga: buffer[0] mm import buffer failed! memory = 0x6f, type = dma_fd(0x0)
[ 3739.870378] [ T2050] rga_dma_buf: Fail to get dma_buf from fd[111], ret[-22]
[ 3739.870391] [ T2050] rga_mm: rga_mm_map_dma_buffer core[1] map dma buffer error!
[ 3739.870394] [ T2050] rga_mm: rga_mm_map_buffer map dma_buf error!
[ 3739.870397] [ T2050] rga: buffer[0] mm import buffer failed! memory = 0x6f, type = dma_fd(0x0)
[ 3739.883184] [ T2050] rga_dma_buf: Fail to get dma_buf from fd[111], ret[-22]
[ 3739.883199] [ T2050] rga_mm: rga_mm_map_dma_buffer core[1] map dma buffer error!
[ 3739.883201] [ T2050] rga_mm: rga_mm_map_buffer map dma_buf error!
[ 3739.883204] [ T2050] rga: buffer[0] mm import buffer failed! memory = 0x6f, type = dma_fd(0x0)
[ 3739.894799] [ T2050] rga_dma_buf: Fail to get dma_buf from fd[111], ret[-22]
[ 3739.894813] [ T2050] rga_mm: rga_mm_map_dma_buffer core[1] map dma buffer error!
[ 3739.894817] [ T2050] rga_mm: rga_mm_map_buffer map dma_buf error!
[ 3739.894820] [ T2050] rga: buffer[0] mm import buffer failed! memory = 0x6f, type = dma_fd(0x0)

```





















