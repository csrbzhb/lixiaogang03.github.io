---
layout:     post
title:      Android I2C 驱动
subtitle:   allwinner rockchip
date:       2023-04-10
author:     LXG
header-img: img/post-bg-map.jpg
catalog: true
tags:
    - driver
---

[I2C通信协议：了解I2C Primer、 PMBus和SMBus](https://www.analog.com/cn/analog-dialogue/articles/i2c-communication-protocol-understanding-i2c-primer-pmbus-and-smbus.html)

## I2C概念

I2C，即Inter-Integrated Circuit，是一种常用的串行通信协议，用于在器件之间——特别是两个或两个以上不同电路之间建立通信。

I2C 有利于设计人员在系统的众多节点之间建立简单、双向、灵活的通信。I2C仅使用两条双向线来发送和接收信息，从而降低了复杂性。它还允许设计人员配置多个主节点系统IC之间的通信。

根据定义，Inter-Integrated Circuit (I2C)——也称为Inter IC——是一种硬件通信协议，它通过一条多主器件、多节点、串行通信总线进行同步通信。同步通信意味着两个（或两个以上）交换数据的器件共享一条公共时钟线。I2C广泛用于将低速外围IC连接到处理器和微控制器。I2C总线由飞利浦公司设计，它让位于同一电路板上的器件之间可以轻松通信。

## 接口

使用一条串行数据(SDA)线、一条串行时钟(SCL)线和一个公共接地来承载所有通信，最大程度地减少连接。

![i2c_interface](/images/i2c/i2c_interface.svg)

每个I2C器件有两条线路：

* SDA是供主器件和节点发送和接收数据的线路。
* SCL是承载时钟信号的线路。SCL总是由I2C主器件生成。规范对时钟信号的低相位和高相位有最短周期要求。

I2C总线仅使用两条双向线路：每个器件的SDA和SCL用于简单的IC间通信。

![i2c_interface_2](/images/i2c/i2c_interface_2.svg)

硬件最重要的注意是在SDA和SCL上加入上拉电阻。I2C器件通过开集或开漏引脚连接到总线，将线路拉低。当没有数据传输时，I2C总线处于高电平空闲状态；线路被被动拉高。要传输数据，须切换线路，即先拉低再释放（又变为高电平）。数据位在时钟下降沿传输。

开漏输出需要一个上拉电阻（图2中的Rp）才能正确输出高电平。上拉电阻连接在输出引脚和高电平所需的输出电压（图2中的VDD）之间。

对于VCC和VDD (5 V)的典型值，4700 Ω是最常用的上拉电阻值。

I2C链路的最大总线长度约为1米（100 kBaud时）或10米（10 kBaud时）。非屏蔽电缆的电容通常要小得多，但只能用在以其他方式加以屏蔽的外壳内。

**A133 案例**

![a133_i2c](/images/i2c/a133_i2c.png)

**总结**

![i2c_characteristic](/images/i2c/i2c_characteristic.png)

I2C 是同步的，因此位的输出通过主器件和节点之间共享的时钟信号与位的采样同步。时钟信号始终由主器件控制。

## I2C读写协议

![i2c_interface_3](/images/i2c/i2c_interface_3.svg)




















